---
slug: fake-captchas
title: "Fake CAPTCHAs and Malvertising"
description: >
  Tigris detected fake CAPTCHAs on our platform. Here's what we did to remove them and stay a step ahead of attackers.
image: ./tiger-in-soc.webp
keywords: [object storage, blob storage, s3, abuse, security]
authors: [ot]
tags: [abuse, security]
---

import CodeBlock from "@theme/CodeBlock";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

import InlineCta from "@site/src/components/InlineCta";

Tigris is a globally distributed, multi-cloud object storage service with built-in support for the S3 API. As Tigris has grown this year, we’ve noticed an uptick in abuse of our platform. A natural side effect of growth in usage is growth in misusage.

Earlier this year, security researchers discovered a [“DeceptionAds” campaign](https://www.infostealers.com/article/deceptionads-fake-captcha-driving-infostealer-infections-and-a-glimpse-to-the-dark-side-of-internet-advertising/) running on several trusted services. Attackers used fake CAPTCHAs that instruct users to perform actions such as pressing "Windows + R," pasting a command, and hitting "Enter." This sequence executes a PowerShell command that installs the Lumma info-stealer malware, compromising personal data including credentials and financial information. The attackers hosted fake CAPTCHAs on Bunny CDN, a legitimate CDN provider, and used BeMob, an ad tracking service, to cloak malicious URLs. Hiding behind trusted infrastructure allowed the attackers to circumvent moderation and other security checks.

![Ty the tiger monitoring alerts in a security operations center](./tiger-in-soc.webp)

{/* truncate */}

Tigris detected a similar pattern with fake CAPTCHAs on our platform back in February of this year. Common threat intelligence monitoring services flagged content hosted on Tigris as malicious and published a list of URLs that included Tigris domains. We ran additional scans and contacted third party services for more information as to the malicious content they had detected. As a result, we removed the content and banned users that were uploading malicious content.

Let’s go through how we detected the scheme, what we did to stop it, and the systems we hardened to prevent it from happening again.

## Scaling Response & Prevention

With petabytes of data entering the platform, we have to be efficient with scanning content. It’s not trivial: a suboptimal solution could eclipse the cost of storage by magnitudes. Not every object can be scanned on write, so modern platforms rely on a multi-layered approach to manage risk that includes:
- Accepting abuse reports & acting on them
- Working with security vendors including researchers for fast response and prevention
- Reasonable scanning & prevention
- Enforcing identity verification for all users, including MFA

Not every file uploaded to the platform can reasonably be scanned, so it’s helpful to think about the larger patterns around abuse. Mainly, the bad actors with many disposable emails and VPNs who recreate accounts and repost the same malicious content. Requiring email verification and multifactor authentication reduces the creation of these accounts dramatically. By leveraging our partners’ reliability systems and incorporating their user reputation score into our considerations, we are able to prevent recurrence and ban users from the platform entirely. 

For users with a lower reputation score who upload content of a commonly exploitable type, we flag their content for scanning in common security tooling.

We also partnered with the vendors and security researchers maintaining commonly used Denylists and repositories of malware used in scanning. We partnered with these vendors to ensure our monitoring caught the same issues they detected so that we can act quickly in response to reports.

And, of course, our Terms of Service do not allow malicious content nor abuse. We also maintain an `abuse@` email for reports and added links to our website for reporting abusive usage.

## Types of Malicious Content 

At Tigris, these are the most common types of malicious content we have detected:

|                                             |                                                                                                                |                                                                                        |
| ------------------------------------------- | -------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| Activity                                    | MITRE ATT\&CK ID & Technique                                                                                   | Description                                                                            |
| User Executes Initial PowerShell Code       | T1566 – Phishing                                                                                               | The attack began with a phishing lure using a fake reCAPTCHA page to deceive the user. |
| Phishing via Fake CAPTCHA Page              | T1204 – User ExecutionT1059.001 – Command and Scripting Interpreter: PowerShell                                | The user was tricked into executing an initial PowerShell script.                      |
| Payload Download via mshta.exe              | T1218.005 – System Binary Proxy Execution: MshtaT1027.009 – Obfuscated Files or Information: Embedded Payloads | The script used mshta.exe to fetch a hidden script containing the payload.             |
| Obfuscated Payload Execution via PowerShell | T1059.001 – PowerShellT1027.013 – Obfuscated Files or Information: Encrypted/Encoded File                      | The payload was encrypted and executed through PowerShell.                             |
| Information Collection Activities           | T1217 – Browser Information DiscoveryT1083 – File and Directory Discovery                                      | The stealer gathered system, browser, and file information.                            |
| Data Exfiltration over C2 Channel           | T1041 – Exfiltration Over C2 Channel                                                                           | The collected data was exfiltrated through a remote C2 channel.                        |

### Example Walkthrough - Fake CAPTCHA

#### Findings

A Lumma Stealer campaign uses fake CAPTCHAs, malvertising, and new evasion techniques to target Windows users globally. The infection chain includes clipboard-based commands run via Windows Run, bypassing browser defenses.

![A fake reCAPTCHA detected by Virus Total and removed from a Tigris bucket](./captcha-sample.png)

<center>
  <small>
    <em>A fake reCAPTCHA detected by Virus Total and removed from a Tigris bucket</em>
  </small>
</center>

#### Sample

![HTML containing an obfuscated Javascript function](./html-sample.png)
<center>
  <small>
    <em>HTML containing an obfuscated Javascript function</em>
  </small>
</center>
{/* truncate */}


This HTML contains an obfuscated Javascript function that looks like this (long code block collapsed):

import markdownChunk from "!!raw-loader!./markdownChunk.js";

<details>
  <summary>Long code block with obfuscated JavaScript function</summary>
  <CodeBlock language="js">{markdownChunk}</CodeBlock>
</details>

This function translates roughly to the code below:

<CodeBlock language="js">
{`(function () {
  var encodedText = "R0cHM6Ly8ybm8uY28vMlpXNno2";
  var buttonId = "kkk";
  var classNameToAdd = "show";

  function decodeBase64(str) {
    return decodeURIComponent(escape(window.atob(str)));
  }

  document.getElementById(buttonId).onclick = function () {
    var textarea = document.createElement("text" + "area");
    textarea.value = decodeBase64(encodedText);
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);
    document.getElementById("i").classList.add(classNameToAdd);
    document.getElementById("k").classList.add(classNameToAdd);
    document.getElementById("ent").removeChild(textarea);
  };
})();`}
</CodeBlock>


The key steps of this function are:
- Decodes a base64 string containing a likely payload (e.g., a malicious link)
- Auto-copies it to the user's clipboard using a hidden `<textarea>`.
- Modifies the DOM to show or hide elements using class changes (show class).
- Triggers on click of an element with ID kkk.
- Tricking users into running commands manually or auto-pasting payloads.

#### Obfuscated Payload Execution via PowerShell

Below HTML code is the original source (long code block collapsed):

import markdownChunk2 from "!!raw-loader!./markdownChunk2.js";

<details>
  <summary>Long code block with obfuscated JavaScript function</summary>
  <CodeBlock language="js">{markdownChunk2}</CodeBlock>
</details>

<InlineCta
  title={"Infinite storage for your embeddings"}
  subtitle={
  "Tigris is object storage that gives you bottomless storage for whatever you want, including your vector embeddings, images, or secret plans to achieve total world domination! Not to mention the seamless global architecture. Give it a try today!"
    }
    button={"Get started today!"}
/>